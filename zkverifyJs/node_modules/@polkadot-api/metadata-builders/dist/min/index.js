"use strict";var Z=Object.create;var I=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ne=(e,n)=>{for(var a in n)I(e,a,{get:n[a],enumerable:!0})},B=(e,n,a,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of ee(n))!re.call(e,i)&&i!==a&&I(e,i,{get:()=>n[i],enumerable:!(l=$(n,i))||l.enumerable});return e};var oe=(e,n,a)=>(a=e!=null?Z(te(e)):{},B(n||!e||!e.__esModule?I(a,"default",{value:e,enumerable:!0}):a,e)),ae=e=>B(I({},"__esModule",{value:!0}),e);var be={};ne(be,{getChecksumBuilder:()=>fe,getDynamicBuilder:()=>ce,getLookupFn:()=>R});module.exports=ae(be);var D=(e,n)=>e.type==="array"&&e.len===n&&e.value.type==="primitive"&&e.value.value==="u8",C={type:"void"},R=e=>{let n=new Map,a=new Set,l=s=>u=>{let b=n.get(u);if(b)return b;if(a.has(u)){let c={id:u};return n.set(u,c),c}a.add(u);let d=s(u);return b=n.get(u),b?Object.assign(b,d):(b={id:u,...d},n.set(u,b)),a.delete(u),b},i=!0,t=!0,r=l(s=>{let{def:u,path:b,params:d}=e[s];if(u.tag==="composite"){if(u.value.length===0)return C;if(u.value.length===1){let c=r(u.value[0].type);return i&&b.at(-1)==="AccountId32"&&D(c,32)?(i=!1,{type:"AccountId32"}):t&&b.at(-1)==="AccountId20"&&D(c,20)?(t=!1,{type:"AccountId20"}):c}return o(u.value)}if(u.tag==="variant"){if(b.length===1&&b[0]==="Option"&&d.length===1&&d[0].name==="T"){let y=r(d[0].type);return y.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:y}}if(b.length===1&&b[0]==="Result"&&d.length===2&&d[0].name==="T"&&d[1].name==="E")return{type:"result",value:{ok:r(d[0].type),ko:r(d[1].type)}};if(u.value.length===0)return C;let c={},p={};return u.value.forEach(y=>{let g=y.name;if(p[g]=y.docs,y.fields.length===0){c[g]={...C,idx:y.index};return}if(y.fields.length===1&&!y.fields[0].name){c[g]={type:"lookupEntry",value:r(y.fields[0].type),idx:y.index};return}c[g]={...o(y.fields),idx:y.index}}),{type:"enum",value:c,innerDocs:p}}if(u.tag==="sequence")return{type:"sequence",value:r(u.value)};if(u.tag==="array"){let{len:c}=u.value,p=r(u.value.type);return!c||p.type==="void"?C:c>0?{type:"array",value:p,len:u.value.len}:p}if(u.tag==="tuple")return u.value.length===0?C:u.value.length>1?m(u.value.map(c=>r(c)),u.value.map(c=>e[c].docs)):r(u.value[0]);if(u.tag==="primitive")return{type:"primitive",value:u.value.tag};if(u.tag==="compact"){let c=r(u.value);return c.type==="void"?{type:"compact",isBig:null}:{type:"compact",isBig:Number(c.value.slice(1))>32}}return{type:u.tag}}),o=s=>{let u=!0,b={},d={};return s.forEach((c,p)=>{u=u&&!!c.name;let y=c.name||p,g=r(c.type);g.type!=="void"&&(b[y]=g,d[y]=c.docs)}),u?{type:"struct",value:b,innerDocs:d}:m(Object.values(b),Object.values(d))},m=(s,u)=>{if(s.every(b=>b.id===s[0].id)&&u.every(b=>!b.length)){let[b]=s;return b.type==="void"?C:{type:"array",value:s[0],len:s.length}}return{type:"tuple",value:s,innerDocs:u}};return r};var f=oe(require("@polkadot-api/substrate-bindings"));var j=(e,n,a)=>(l,i,t,...r)=>{let{id:o}=l;if(i.has(o))return i.get(o);if(t.has(o)){let s=n(()=>i.get(o),l,...r);return i.set(o,s),s}t.add(o);let m=e(l,i,t,...r);return t.delete(o),i.has(o)&&(m=a(m,i.get(o),l,...r)),i.set(o,m),m};var P=require("@polkadot-api/utils"),ue=f.Bin(),ie=f.createCodec(f.compact[0],f.enhanceDecoder(f.compact[1],BigInt)),se=(e,n,a,l)=>{if(e.type==="primitive")return f[e.value];if(e.type==="void")return f._void;if(e.type==="AccountId32")return l;if(e.type==="AccountId20")return f.ethAccount;if(e.type==="compact")return e.isBig?ie:f.compact;if(e.type==="bitSequence")return f.bitSequence;let i=d=>_(d,n,a,l),t=(d,c)=>{let p=i(d);return c?f.Vector(p,c):f.Vector(p)},r=d=>f.Tuple(...d.map(i)),o=d=>{let c=Object.fromEntries(Object.entries(d).map(([p,y])=>[p,i(y)]));return f.Struct(c)};if(e.type==="sequence"&&e.value.type==="primitive"&&e.value.value==="u8")return ue;if(e.type==="array")return e.value.type==="primitive"&&e.value.value==="u8"?f.Bin(e.len):t(e.value,e.len);if(e.type==="sequence")return t(e.value);if(e.type==="tuple")return r(e.value);if(e.type==="struct")return o(e.value);if(e.type==="option")return f.Option(i(e.value));if(e.type==="result")return f.Result(i(e.value.ok),i(e.value.ko));let m=Object.values(e.value).map(d=>{switch(d.type){case"void":return f._void;case"lookupEntry":return i(d.value);case"tuple":return r(d.value);case"struct":return o(d.value);case"array":return t(d.value,d.len)}}),s=Object.fromEntries(Object.keys(e.value).map((d,c)=>[d,m[c]])),u=Object.values(e.value).map(d=>d.idx);return u.every((d,c)=>d===c)?f.Variant(s):f.Variant(s,u)},_=j(se,f.Self,e=>e),ce=e=>{let n=e.lookup,a=R(n),l=f.AccountId(),i=new Map,t=p=>_(a(p),i,new Set,l),r=e.pallets.find(p=>p.name==="System")?.constants.find(p=>p.name==="SS58Prefix"),o;if(r)try{let p=t(r.type).dec(r.value);typeof p=="number"&&(o=p,l=f.AccountId(p))}catch{}let m=new Map,s=(p,y)=>{let g=m.get(p);g||m.set(p,g=f.Storage(p));let v=e.pallets.find(L=>L.name===p).storage.items.find(L=>L.name===y),V=(L,...x)=>{let T=g(...x);return{...T,len:L,fallback:v.modifier===1?T.dec(v.fallback):void 0}};if(v.type.tag==="plain")return V(0,y,t(v.type.value).dec);let{key:E,value:w,hashers:Q}=v.type.value,X=t(w),A=Q.map(L=>f[L.tag]),Y=(()=>{if(A.length===1)return[[t(E),A[0]]];let L=a(E);switch(L.type){case"array":return A.map(x=>[t(L.value.id),x]);case"tuple":return L.value.map((x,T)=>[t(x.id),A[T]]);default:throw new Error("Invalid key type")}})();return V(A.length,y,X.dec,...Y)},u=p=>{switch(p.type){case"void":return f._void;case"lookupEntry":return t(p.value.id);case"tuple":return f.Tuple(...Object.values(p.value).map(y=>t(y.id)));case"struct":return f.Struct((0,P.mapObject)(p.value,y=>t(y.id)));case"array":return f.Vector(t(p.value.id),p.len)}},b=(p,y)=>{let g=e.pallets.find(v=>v.name===p).constants.find(v=>v.name===y);return t(g.type)},d=p=>(y,g)=>{let v=e.pallets.find(w=>w.name===y),V=a(v[p]);if(V.type!=="enum")throw null;let E=V.value[g];return{location:[v.index,E.idx],codec:u(V.value[g])}},c=(p,y)=>{let g=e.apis.find(v=>v.name===p)?.methods.find(v=>v.name===y);if(!g)throw null;return{args:f.Tuple(...g.inputs.map(v=>t(v.type))),value:t(g.output)}};return{buildDefinition:t,buildStorage:s,buildEvent:d("events"),buildError:d("errors"),buildRuntimeCall:c,buildCall:d("calls"),buildConstant:b,ss58Prefix:o}};var q=require("@polkadot-api/substrate-bindings");function W(e,n){let a=new Map,l=new Set,i=(t,r)=>{a.has(t)||a.set(t,{entry:e(t),backRefs:new Set,refs:new Set}),a.has(r)||a.set(r,{entry:e(r),backRefs:new Set,refs:new Set}),a.get(t).refs.add(r),a.get(r).backRefs.add(t)};for(let t=0;t<n;t++){let r=e(t);if(t!==r.id&&i(t,r.id),!l.has(r.id)){switch(l.add(r.id),r.type){case"array":case"option":case"sequence":i(r.id,r.value.id);break;case"enum":Object.values(r.value).forEach(o=>{switch(o.type){case"array":case"lookupEntry":i(r.id,o.value.id);break;case"struct":case"tuple":Object.values(o.value).forEach(m=>i(r.id,m.id));break}});break;case"result":i(r.id,r.value.ok.id),i(r.id,r.value.ko.id);break;case"struct":case"tuple":Object.values(r.value).forEach(o=>i(r.id,o.id));break}a.has(r.id)||a.set(r.id,{backRefs:new Set,refs:new Set,entry:r})}}return a}var O=new WeakMap;function G(e,n,a,l){if(a.has(e))return;let i=n.get(e);a.set(e,i),l.set(e,a),i.refs.forEach(t=>G(t,n,a,l)),i.backRefs.forEach(t=>G(t,n,a,l))}function z(e,n){O.has(n)||O.set(n,new Map);let a=O.get(n);if(a.has(e))return a.get(e);let l=new Map;return G(e,n,l,a),l}function F(e){let n=new Map,a=0,l=[],i=[];function t(r){let o={index:a,lowLink:a,onStack:!0};n.set(r,o),a++,l.push(r);let m=e.get(r).refs;for(let s of m){let u=n.get(s);u?u.onStack&&(o.lowLink=Math.min(o.lowLink,u.index)):(t(s),o.lowLink=Math.min(o.lowLink,n.get(s).lowLink))}if(o.lowLink===o.index){let s=new Set,u=-1;do u=l.pop(),n.get(u).onStack=!1,s.add(u);while(u!==r);s.size>1&&i.push(s)}}for(let r of e.keys())n.has(r)||t(r);return i}function N(e){let n=e,a=new Set(n.map((t,r)=>r)),l=new Map(n.map((t,r)=>[r,new Set]));n.forEach((t,r)=>{n.slice(r+1).forEach((o,m)=>{let s=m+r+1;new Set([...t,...o]).size!==t.size+o.size&&(l.get(r).add(s),l.get(s).add(r))})});let i=[];for(;a.size;){let t=new Set,r=[a.values().next().value];for(;r.length;){let o=r.pop();if(!a.has(o))continue;a.delete(o),n[o].forEach(s=>t.add(Number(s))),l.get(o).forEach(s=>r.push(s))}i.push(t)}return i}var U=new TextEncoder,le=U.encode.bind(U),h=e=>{let n=new Uint8Array(e.length*8),a=new DataView(n.buffer);for(let l=0;l<e.length;l++)a.setBigUint64(l*8,e[l]);return(0,q.h64)(n)},K=e=>h(e.map(n=>(0,q.h64)(le(n)))),S={primitive:0n,vector:1n,tuple:2n,struct:3n,option:4n,result:5n,enum:6n,void:7n},k={undefined:0n,number:1n,string:2n,bigint:3n,boolean:4n,bitSequence:5n,byteSequence:6n,accountId32:7n,accountId20:8n},pe={bool:k.boolean,char:k.string,str:k.string,u8:k.number,u16:k.number,u32:k.number,u64:k.bigint,u128:k.bigint,u256:k.bigint,i8:k.number,i16:k.number,i32:k.number,i64:k.bigint,i128:k.bigint,i256:k.bigint},M=(e,n,a)=>{let l=Object.entries(n).sort(([r],[o])=>r.localeCompare(o)),i=K(l.map(([r])=>r)),t=h(l.map(([,r])=>a(r)));return h([e,i,t])},H=(e,n)=>{if(e.type==="primitive")return h([S.primitive,pe[e.value]]);if(e.type==="void")return h([S.void]);if(e.type==="compact")return h([S.primitive,k[e.isBig||e.isBig===null?"bigint":"number"]]);if(e.type==="bitSequence")return h([S.primitive,k.bitSequence]);if(e.type==="AccountId32")return h([S.primitive,k.accountId32]);if(e.type==="AccountId20")return h([S.primitive,k.accountId20]);let a=(t,r)=>{let o=n(t);return h(r!==void 0?[S.vector,o,BigInt(r)]:[S.vector,o])};if(e.type==="array"){let t=e.value;return t.type==="primitive"&&t.value==="u8"?h([S.primitive,k.byteSequence,BigInt(e.len)]):a(t,e.len)}if(e.type==="sequence"){let t=e.value;return t.type==="primitive"&&t.value==="u8"?h([S.primitive,k.byteSequence]):a(t)}let l=t=>h([S.tuple,...t.map(n)]),i=t=>M(S.struct,t,n);return e.type==="tuple"?l(e.value):e.type==="struct"?i(e.value):e.type==="option"?h([S.option,n(e.value)]):e.type==="result"?h([S.result,n(e.value.ok),n(e.value.ko)]):M(S.enum,e.value,t=>{if(t.type==="lookupEntry")return n(t.value);switch(t.type){case"void":return h([S.void]);case"tuple":return l(t.value);case"struct":return i(t.value);case"array":return a(t.value,t.len)}})},de=(e,n)=>{let a=t=>{let r=new Set,o=Array.from(t);for(;o.length;){let m=o.pop();r.has(m)||(r.add(m),n.get(m)?.refs.forEach(s=>o.push(s)))}return Array.from(r)},l=new Array;function i(t){l.includes(t)||(e.filter(o=>o!==t&&a(t).some(m=>o.has(m))).forEach(o=>i(o)),l.includes(t))||l.push(t)}return e.forEach(t=>i(t)),l};function J(e,n,a,l){let i=new Map([...e].map(o=>[o,0n])),t=new Map,r=(o,m=!0)=>{if(!m&&(i.has(o.id)||a.has(o.id)))return i.get(o.id)??a.get(o.id);let s=H(o,u=>r(u,!1));return e.has(o.id)?t.set(o.id,s):a.set(o.id,s),s};for(let o=0;o<n;o++)e.forEach(m=>r(l.get(m).entry)),e.forEach(m=>i.set(m,t.get(m)));return i}function me(e,n){let a=e.reduce((m,s)=>Math.max(m,s.size),0),l=new Set([...n.values()].map(m=>m.entry.id)),i=J(l,a,new Map,n),t=new Map;for(let m of l){let s=i.get(m);if(s==null)throw new Error("Unreachable");t.has(s)||t.set(s,[]),t.get(s).push(m)}let r=[...t.entries()].filter(([,m])=>m.length>1),o={};return r.forEach(([,m])=>{m.forEach(s=>o[s]=m)}),o}var ye=(e,n,a)=>{if(n.has(e.id))return n.get(e.id);let l=z(e.id,a),i=F(l),t=N(i).filter(s=>!n.has(s.values().next().value)),r=me(t,l);de(t.filter(s=>s.size>1),l).forEach(s=>{if(n.has(s.values().next().value))return;let u=J(s,s.size,n,a);s.forEach(b=>{let d=u.get(b);b in r?r[b].forEach(c=>n.set(c,d)):n.set(b,d)})});let m=s=>n.has(s.id)?n.get(s.id):H(s,m);return m(e)},fe=e=>{let n=e.lookup,a=R(n),l=W(a,n.length),i=new Map,t=c=>ye(a(c),i,l),r=(c,p)=>{try{let y=e.pallets.find(w=>w.name===c).storage.items.find(w=>w.name===p);if(y.type.tag==="plain")return t(y.type.value);let{key:g,value:v}=y.type.value,V=t(v),E=t(g);return h([V,E])}catch{return null}},o=(c,p)=>{try{let y=e.apis.find(E=>E.name===c)?.methods.find(E=>E.name===p);if(!y)throw null;let g=K(y.inputs.map(E=>E.name)),v=h(y.inputs.map(E=>t(E.type))),V=t(y.output);return h([g,v,V])}catch{return null}},m=c=>{if(c.type==="void")return h([0n]);if(c.type==="tuple"){let p=Object.values(c.value).map(y=>t(y.id));return h([S.tuple,...p])}return c.type==="array"?h([S.vector,t(c.value.id),BigInt(c.len)]):M(S.struct,c.value,p=>t(p.id))},s=c=>M(S.tuple,c.value,p=>t(p.id)),u=c=>(p,y)=>{try{let g=e.pallets.find(E=>E.name===p),v=a(g[c]);if(t(v.id),v.type!=="enum")throw null;let V=v.value[y];return V.type==="lookupEntry"?t(V.value.id):m(V)}catch{return null}},b=(c,p)=>{try{let y=e.pallets.find(g=>g.name===c).constants.find(g=>g.name===p);return t(y.type)}catch{return null}},d=c=>(...p)=>c(...p)?.toString(32)??null;return{buildDefinition:d(t),buildRuntimeCall:d(o),buildStorage:d(r),buildCall:d(u("calls")),buildEvent:d(u("events")),buildError:d(u("errors")),buildConstant:d(b),buildComposite:d(m),buildNamedTuple:d(s),getAllGeneratedChecksums:()=>Array.from(i.values()).map(c=>c.toString(32))}};
//# sourceMappingURL=index.js.map