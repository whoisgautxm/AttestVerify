"use strict";var d=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var P=(e,t)=>{for(var n in t)d(e,n,{get:t[n],enumerable:!0})},N=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of T(t))!E.call(e,s)&&s!==n&&d(e,s,{get:()=>t[s],enumerable:!(o=A(t,s))||o.enumerable});return e};var O=e=>N(d({},"__esModule",{value:!0}),e);var q={};P(q,{getSyncProvider:()=>L});module.exports=O(q);var[_,J,w]=["follow","unfollow","followEvent"].map(e=>new Set(["v1","unstable"].map(t=>`chainHead_${t}_${e}`))),h="stop",S=e=>{let t="";return{onSent(n){return _.has(n.method)?(t=n.method+"Event",{type:"subscribe",id:n.id,onRes:o=>o.id===n.id?{id:o.result}:null}):J.has(n.method)?{type:"unsubscribe",id:Object.values(n.params)[0]}:null},onNotification(n){return w.has(n.method)&&n.params.result.event===h?{type:"end",id:n.params.subscription}:null},onAbort:n=>{e(JSON.stringify({jsonrpc:"2.0",method:t,params:{subscription:n,result:{event:h}}}))}}};var I=["v1","unstable"],M=["transactionWatch","transaction"],x=I.map(e=>M.map(t=>[e,t])).flat(),[H,C]=["submitAndWatch","unwatch"].map(e=>new Set(x.map(([t,n])=>`${n}_${t}_${e}`))),g="dropped",D=new Set([g,"finalized","error","invalid"]),y=e=>{let t="";return{onSent(n){if(H.has(n.method)){if(!t){let[o,s]=n.method.split("_");t=[o,s,"watchEvent"].join("_")}return{type:"subscribe",id:n.id,onRes:o=>o.id===n.id?{id:o.result}:null}}return C.has(n.method)?{type:"unsubscribe",id:Object.values(n.params)[0]}:null},onNotification(n){return t!==n.method?null:D.has(n.params.result.event)?{type:"end",id:n.params.subscription}:null},onAbort:n=>{e(JSON.stringify({jsonrpc:"2.0",method:t,params:{subscription:n,result:{event:g}}}))}}};var j=({onSent:e,onNotification:t,onAbort:n})=>{let o=new Map,s=new Set,u=()=>{o.clear(),s.clear()};return{onSent(a){let c=e(a);c&&(c.type==="subscribe"?o.set(c.id,c.onRes):s.delete(c.id))},onResponse(a){let c=o.get(a.id)?.(a);c&&(o.delete(a.id),s.add(c.id))},onNotifiaction(a){let c=t(a);c&&s.delete(c.id)},onDisconnect:u,onAbort(){let a=[...s];u(),a.forEach(n)}}},v=e=>{let t=[S,y].map(n=>j(n(e)));return{onSent(n){t.forEach(o=>{o.onSent(n)})},onResponse(n){t.forEach(o=>{o.onResponse(n)})},onNotifiaction(n){t.forEach(o=>{o.onNotifiaction(n)})},onDisconnect(){t.forEach(n=>n.onDisconnect())},onAbort(){t.forEach(n=>n.onAbort())}}};var L=e=>t=>{let n,o=[],s=new Set,u=v(t),a=i=>{let r;try{r=JSON.parse(i)}catch{console.error(`Unable to parse incoming message: ${i}`);return}r.id!==void 0?(s.delete(r.id),u.onResponse(r)):u.onNotifiaction(r),t(i)},c=i=>{if(!n)return;let r=JSON.parse(i);u.onSent(r),r.id&&s.add(r.id),n instanceof Promise?o.push(i):n.send(i)},m=()=>{o=[];let i=[...s];if(s.clear(),!n)throw null;let r=f();return u.onAbort(),i.forEach(p=>{t(JSON.stringify({jsonrpc:"2.0",error:{code:-32603,message:"Internal error"},id:p}))}),r},f=()=>{let i=r=>{let p=!1,b=r(l=>{p||a(l)},()=>{p||(p=!0,m())});return o.forEach(l=>{b.send(l)}),o=[],n=b};return n=e().then(i,$(m)),n},R=()=>{if(!n)return;let i=r=>{u.onDisconnect(),s.clear(),n=null,r?.disconnect()};n instanceof Promise?(n.then(i,i),n=null):i(n)};return f(),{send:c,disconnect:R}},$=e=>(...t)=>new Promise(n=>setTimeout(n,0)).then(()=>e(...t));
//# sourceMappingURL=index.js.map